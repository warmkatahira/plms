import{C,c as g}from"./color-Cr0TjCwm.js";let w=null;$(document).ready(function(){const t=new Date,n=t.getFullYear(),e=String(t.getMonth()+1).padStart(2,"0"),o=`${n}-${e}`;S(o)});function S(t){$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},url:"/dashboard/ajax_get_chart_data",type:"GET",data:{month:t},dataType:"json",success:function(e){try{q(e),N(e);const o=t.split("-"),s=o[0]+"年"+o[1]+"月";$("#calendar_year").html(s),$("#total_shipped_label").html(s+" 出荷実績"),$("#sagyo_mae_order_count").html(Number(e.info.sagyo_mae_order_count).toLocaleString()),$("#sagyo_mae_ship_quantity").html(Number(e.info.sagyo_mae_ship_quantity).toLocaleString()),$("#sagyo_chu_order_count").html(Number(e.info.sagyo_chu_order_count).toLocaleString()),$("#sagyo_chu_ship_quantity").html(Number(e.info.sagyo_chu_ship_quantity).toLocaleString()),$("#total_shipped_count").html(Number(e.info.month_shipped_count).toLocaleString()),$("#total_shipped_quantity").html(Number(e.info.month_shipped_quantity).toLocaleString())}catch{alert("オブジェクトの生成に失敗しました。")}},error:function(){alert("オブジェクトの生成に失敗しました。")}})}function q(t){w&&w.destroy();let n=[];$.each(t.dates,function(a,y){n.push(y.date)});const e={labels:n,datasets:[D(t.shipping_count,t.dates),L(t.shipping_quantity,t.dates)]},o=document.getElementById("shipping_history_chart"),s=o.getContext("2d");o.width=o.parentElement.clientWidth,o.height=600,w=new C(s,{data:e,options:{responsive:!1,scales:{"y-axis-count":{type:"linear",position:"left",ticks:{max:200,min:0,stepSize:10,precision:0,callback:function(a){return Number.isInteger(a)?a:null}}},"y-axis-quantity":{type:"linear",position:"right",ticks:{max:500,min:0,stepSize:50,precision:0,callback:function(a){return Number.isInteger(a)?a:null}},grid:{drawOnChartArea:!1}}},plugins:{legend:{labels:{usePointStyle:!0}},tooltip:{bodyFont:{size:16},titleFont:{size:18},padding:12,boxPadding:6}}}})}function D(t,n){let e=[];return $.each(n,function(o,s){let a=t.hasOwnProperty(o)?t[o].count:0;e.push(a)}),{type:"line",label:"出荷件数",data:e,borderColor:g[0].borderColor,backgroundColor:g[0].backgroundColor,pointBackgroundColor:g[0].borderColor,pointRadius:5,pointHoverRadius:7,yAxisID:"y-axis-count"}}function L(t,n){let e=[];return $.each(n,function(o,s){let a=t.hasOwnProperty(o)?t[o].total_quantity:0;e.push(a)}),{type:"bar",label:"出荷数量",data:e,borderColor:g[1].borderColor,backgroundColor:g[1].backgroundColor,pointBackgroundColor:g[1].borderColor,pointRadius:5,pointHoverRadius:7,yAxisID:"y-axis-quantity"}}$(document).on("click",".month_change",function(){const t=$(this).attr("data-month"),n=M(t);$("#previous_month").attr("data-month",n.previous),$("#next_month").attr("data-month",n.next),S(t)});function N(t){var k,v;const n=$("#shipping_calendar"),e=Object.keys(t.dates),s=new Date(e[0]).getDay();let a=0;const y=["日","月","火","水","木","金","土"];let m="<thead><tr>";y.forEach((l,r)=>{m+=`<th class="font-thin border border-black w-1/7 ${r===0?"bg-pink-100":r===6?"bg-blue-100":""}">${l}</th>`}),m+="</tr></thead>";let p="<tbody>";for(let l=0;l<6;l++){p+='<tr class="h-24">';for(let r=0;r<7;r++){let u="",i=null,b=null,h="",_="",f="text-black";if(l===0&&r<s){let c="";r===0&&(c="bg-pink-100"),r===6&&(c="bg-blue-100"),p+=`<td class="border border-black ${c}"></td>`;continue}const d=e[a];if(d){const c=new Date(d),x=c.toISOString().split("T")[0];u=c.getDate(),i=Number(((k=t.shipping_count[x])==null?void 0:k.count)??0).toLocaleString(),b=Number(((v=t.shipping_quantity[x])==null?void 0:v.total_quantity)??0).toLocaleString(),a++,t.dates[d].holiday!==null&&(h="bg-pink-100",_=t.dates[d].holiday,f="text-red-500")}if(r===0&&(h="bg-pink-100",f="text-red-500"),r===6&&(h="bg-blue-100"),u){let c="",x="";i&&i!=0&&(c=`/shipping_history?search_type=search&search_shipping_date_from=${d}&search_shipping_date_to=${d}`,x="hover:bg-theme-sub cursor-pointer"),p+=`
                    <td class="border border-black align-top w-1/7 ${x} ${h}">
                        <a ${c?`href="${c}"`:""} class="${i&&i!=0?"tippy_shipping_history":""}" data-ymd="${d}" data-holiday-name="${_}" data-count="${i}" data-quantity="${b}">
                            <div class="flex flex-col gap-2 p-2 text-xs">
                                <div class="flex flex-row items-center gap-2 w-full relative">
                                    <strong class="text-base text-left ${f}">${u}</strong>
                                    ${_?`
                                    <div class="ml-2 overflow-hidden flex-1 relative h-5">
                                        <div class="absolute whitespace-nowrap animate-marquee">
                                            ${_}
                                        </div>
                                    </div>`:""}
                                </div>
                                ${i&&i!=0?`
                                <div class="flex flex-row text-xs border-dashed border-b border-black">
                                    <p class="w-1/2">件数</p>
                                    <p class="w-1/2 text-right truncate overflow-hidden whitespace-nowrap">${i}</p>
                                </div>
                                <div class="flex flex-row text-xs border-dashed border-b border-black">
                                    <p class="w-1/2">数量</p>
                                    <p class="w-1/2 text-right truncate overflow-hidden whitespace-nowrap">${b}</p>
                                </div>`:""}
                            </div>
                        </a>
                    </td>
                `}else p+=`<td class="border border-black ${h}"></td>`}p+="</tr>"}p+="</tbody>",n.html(m+p),tippy(".tippy_shipping_history",{content(l){const r=l.getAttribute("data-ymd"),u=l.getAttribute("data-holiday-name"),i=l.getAttribute("data-count"),b=l.getAttribute("data-quantity"),[h,_,f]=r.split("-"),d=u?`(${u})`:"";return`出荷履歴へ移動<br><br>日付：${h}年${_}月${f}日${d}<br>件数：${i}<br>数量：${b}`},duration:500,maxWidth:"none",allowHTML:!0,placement:"right",theme:"tippy_main_theme"})}function M(t){const[n,e]=t.split("-").map(Number),o=new Date(n,e-1),s=new Date(o.getFullYear(),o.getMonth()-1),a=new Date(o.getFullYear(),o.getMonth()+1),y=m=>`${m.getFullYear()}-${String(m.getMonth()+1).padStart(2,"0")}`;return{previous:y(s),next:y(a)}}tippy(".tippy_current_month",{content:"今月へ",duration:500,maxWidth:"none",allowHTML:!0,placement:"right",theme:"tippy_main_theme"});tippy(".tippy_previous_month",{content:"前月へ",duration:500,maxWidth:"none",allowHTML:!0,placement:"right",theme:"tippy_main_theme"});tippy(".tippy_next_month",{content:"翌月へ",duration:500,maxWidth:"none",allowHTML:!0,placement:"right",theme:"tippy_main_theme"});
