import{a as i}from"./audio-BXh7UfBs.js";import{s as d}from"./loading-CLXJ3Lsj.js";function m(o){const e=u(o);e.push("点です"),c(e)}function u(o){const e=Number(o),t=[];if(e>=1e3){const n=Math.floor(e/1e3)*1e3;t.push(String(n))}if(e%1e3>=100){const n=Math.floor(e%1e3/100)*100;n>0&&t.push(String(n))}if(e%100>=10){const n=Math.floor(e%100/10)*10;n>0&&t.push(String(n))}const r=e%10;return r>0&&t.push(String(r)),t.length===0&&t.push("0"),t}function c(o){if(o.length===0)return;const[e,...t]=o,r=new Audio(`/audio/number/${e}.mp3`);r.play(),r.addEventListener("ended",()=>{c(t)})}$(document).ready(function(){$("#order_control_id").focus()});$("#order_control_id").on("change",function(){$("#order_control_id").val()&&$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},url:"/shipping_inspection/ajax_check_order_control_id",type:"POST",data:{order_control_id:$("#order_control_id").val()},dataType:"json",success:function(e){try{if(e.error_message)throw $("#order_control_id").val(null),$("#order_control_id").focus(),new Error(e.error_message);$("#order_control_id").prop("disabled",!0),$("#order_control_id").addClass("bg-gray-200"),$("#tracking_no").focus(),$("#message").html(null),i("proc")}catch(t){i("ng"),$("#message").html(t.message)}},error:function(){alert("失敗")}})});$("#tracking_no").on("change",function(){$("#tracking_no").val()&&$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},url:"/shipping_inspection/ajax_check_tracking_no",type:"POST",data:{order_control_id:$("#order_control_id").val(),tracking_no:$("#tracking_no").val()},dataType:"json",success:function(e){try{if(e.error_message)throw $("#tracking_no").val(null),$("#tracking_no").focus(),new Error(e.error_message);$("#tracking_no").prop("disabled",!0),$("#tracking_no").addClass("bg-gray-200"),_(),$("#message").html(null),p(e.inspection_targets),s(),e.inspection_targets.length===0&&l(),m(e.total_ship_quantity)}catch(t){i("ng"),$("#message").html(t.message)}},error:function(){alert("失敗")}})});function p(o){for(let e of o){let t=$("<tr id='"+e.item_id+"' class='text-left hover:bg-theme-sub cursor-default whitespace-nowrap'>");t.append($("<td class='py-1 px-2 border'>").text(e.item_jan_code)),t.append($("<td class='py-1 px-2 border'>").text(e.item_name)),t.append($("<td class='ship_quantity py-1 px-2 border text-right'>").text(e.total_ship_quantity)),t.append($("<td class='inspection_quantity py-1 px-2 border text-right'>").text(0)),$("#inspection_target_table").append(t)}}$("#item_id_code").on("change",function(){$("#item_id_code").val()&&$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},url:"/shipping_inspection/ajax_check_item_id_code",type:"POST",data:{order_control_id:$("#order_control_id").val(),item_id_code:$("#item_id_code").val()},dataType:"json",success:function(e){console.log(e.progress);try{if(e.error_info)throw e.error_info;e.inspection&&(_(),$("#message").html(null),$("#"+e.item_id+" .inspection_quantity").text(e.inspection_quantity),s(),e.inspection_complete&&$("#"+e.item_id).appendTo($("#inspection_complete_table")),e.inspection_complete_order&&l(),i("proc"))}catch(t){i("ng"),$("#item_id_code_alert_modal").removeClass("hidden"),$("#error_message").html(t.message),$("#error_item_id_code").html(t.item_id_code),$("#error_item_name").html(t.item_name),$("#error_item_image").attr("src","/storage/item_images/"+t.item_image_file_name),$("#item_id_code_alert_modal_focus_element").focus()}},error:function(){alert("失敗")}})});$("#item_id_code_alert_modal_focus_element").on("change",function(){i("ng"),$("#item_id_code_alert_modal_focus_element").val(null),$("#item_id_code_alert_modal_focus_element").focus()});const a=$("#item_id_code_alert_modal_focus_element");a.on("blur",function(){setTimeout(()=>{a.focus()},0)});function _(){$("#item_id_code").val(null),$("#item_id_code").focus()}function s(){let o=0,e=0;$(".ship_quantity").each(function(){o+=parseInt($(this).text())}),$(".inspection_quantity").each(function(){e+=parseInt($(this).text())}),$("#remaining_pcs").html(o-e)}$(document).on("click",function(o){o.target.classList.contains("item_id_code_alert_modal_close")==!0&&($("#item_id_code_alert_modal").addClass("hidden"),_())});function l(){d(),$("#item_id_code").prop("disabled",!0),$("#item_id_code").addClass("bg-gray-200"),i("complete",function(){$("#order_control_id").prop("disabled",!1),$("#shipping_inspection_form").submit()})}
